#!/bin/bash

# List all of the branches on "origin" that aren't master ordered by latest
# commit (newest first). Helps identify dead branches.

set -e

git fetch origin -q
git remote prune origin

branches=$(git branch -r | grep "origin/" | grep -v HEAD | grep -v master)

for i in $branches; do
  echo `git log -n1 --pretty=format:"%ai %Cgreen%h%Creset %Cred(%ar)%Creset %Cblue<%an>%Creset" $i` \
    "$i -"`git log --oneline $i ^origin/master | wc -l`" commit(s) not in master"
done | sort -r | cut -c27-
